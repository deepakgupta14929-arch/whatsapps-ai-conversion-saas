<h1 class="text-2xl font-bold mb-2">Settings</h1>
<p class="text-slate-300 text-sm mb-6">
  Manage your profile, WhatsApp Cloud API and automation.
</p>

<div class="grid md:grid-cols-2 gap-6">
  <!-- Profile Section -->
  <div class="bg-slate-900/70 border border-slate-800 rounded-2xl p-5">
    <h2 class="font-semibold mb-3 text-sm text-white">Profile</h2>

    <form class="space-y-3 text-sm" method="POST" action="/settings/profile">
      <div>
        <label class="text-xs text-slate-400 mb-1 block">Name</label>
        <input
          name="name"
          value="<%= currentUser?.name %>"
          class="w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-emerald-500"
        />
      </div>

      <div>
        <label class="text-xs text-slate-400 mb-1 block">Email</label>
        <input
          type="email"
          name="email"
          value="<%= currentUser?.email %>"
          class="w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white text-sm focus:outline-none focus:ring-1 focus:ring-emerald-500"
        />
      </div>

      <button
        class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 text-xs font-semibold px-4 py-2 rounded-xl">
        Save changes
      </button>
    </form>
  </div>

  <!-- WhatsApp Integration -->
  <div class="bg-slate-900/70 border border-slate-800 rounded-2xl p-5">
    <h2 class="font-semibold mb-3 text-sm text-white">WhatsApp &amp; AI</h2>

    <form class="space-y-3 text-sm" method="POST" action="/settings/whatsapp">
      <div>
        <label class="text-xs text-slate-400 mb-1 block">WhatsApp Access Token</label>
        <input
          type="text"
          name="whatsappAccessToken"
          class="w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white text-xs focus:outline-none focus:ring-1 focus:ring-emerald-500"
          placeholder="Paste token from Meta → WhatsApp → API Setup"
          value="<%= currentUser?.whatsappAccessToken || '' %>"
          required
        />
      </div>

      <div>
        <label class="text-xs text-slate-400 mb-1 block">Phone Number ID</label>
        <input
          type="text"
          name="phoneNumberId"
          class="w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-white text-xs focus:outline-none focus:ring-1 focus:ring-emerald-500"
          placeholder="e.g. 862348566966875"
          value="<%= currentUser?.phoneNumberId || '' %>"
          required
        />
      </div>

      <button
        class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 text-xs font-semibold px-4 py-2 rounded-xl">
        Save WhatsApp Settings
      </button>
    </form>

    <div class="mt-3 flex items-center gap-3">
      <a href="/settings/test-whatsapp">
        <button
          class="bg-blue-500 hover:bg-blue-400 text-white text-xs font-semibold px-4 py-2 rounded-xl">
          Test WhatsApp Connection
        </button>
      </a>

      <% if (currentUser?.whatsappConnected) { %>
        <span class="text-emerald-400 text-xs font-semibold">
          ✔ Connected to WhatsApp
        </span>
      <% } else { %>
        <span class="text-red-400 text-xs font-semibold">
          ❌ Not Connected
        </span>
      <% } %>
    </div>
  </div>
</div>

<!-- Auto Follow-Ups Section -->
<div class="mt-6 bg-slate-900/70 border border-slate-800 rounded-2xl p-5 text-sm">
  <h2 class="font-semibold mb-3 text-slate-100 text-sm">Auto Follow-Ups</h2>

  <form method="POST" action="/settings/automation" class="space-y-4">
    <div class="flex items-center gap-2 text-xs">
      <input
        type="checkbox"
        name="enabled"
        id="enabled"
        <%= automation && automation.enabled ? 'checked' : '' %>
      />
      <label for="enabled" class="text-slate-300">Enable automation for new leads</label>
    </div>

    <div>
      <h3 class="text-xs font-semibold text-slate-300 mb-1">Current rules</h3>

      <% if (automation && automation.followUps && automation.followUps.length) { %>
        <ul class="space-y-1 text-xs">
          <% automation.followUps.forEach(function(fu, i) { %>
            <li class="text-slate-200">
              After <span class="font-semibold"><%= fu.delayHours %></span> hrs —
              via <span class="font-semibold capitalize"><%= fu.channel %></span>
              <br />
              <span class="text-slate-400">"<%= fu.message %>"</span>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <p class="text-slate-400 text-xs">
          No follow-ups set yet. Add your first WhatsApp or email follow-up below.
        </p>
      <% } %>
    </div>

    <div class="border-t border-slate-800 pt-3 space-y-2">
      <h3 class="text-xs font-semibold text-slate-300">Add new follow-up</h3>

      <div class="flex flex-wrap gap-2 items-center text-xs">
        <select
          name="channel"
          class="bg-slate-950 border border-slate-700 rounded-xl px-2 py-1 text-xs text-slate-100">
          <option value="whatsapp">WhatsApp</option>
          <option value="email">Email</option>
        </select>

        <input 
         type="number" 
        name="delayHours" 
      placeholder="Hours delay" 
  step="0.01"
  min="0.01"
  required
>

      </div>

      <textarea
        name="message"
        rows="3"
        class="w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-2 text-xs text-slate-100"
        placeholder="Write the follow-up message you want to send..."
        required
      ></textarea>

      <button
        class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 text-xs font-semibold px-4 py-2 rounded-xl">
        ➕ Add Follow-Up
      </button>
    </div>
  </form>
</div>

